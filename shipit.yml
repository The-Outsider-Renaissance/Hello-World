dependencies:
  override: []

deploy:
  max_commits: # Automatically deploy all commits, no matter how many.
  override:
    - |
      PIDS=""

      bin/deployer bash -lc "id=wumpus bin/deploy" &
      PIDS="${PIDS} $!"

      bin/deployer bash -lc "id=boom bin/deploy" &
      PIDS="${PIDS} $!"

      bin/deployer bash -lc "id=bumpus bin/deploy" &
      PIDS="${PIDS} $!"

      echo "Deployer PIDs: ${PIDS}"

      EXIT_STATUS=0
      for pid in ${PIDS}; do
          wait "${pid}" || EXIT_STATUS=1
      done

      echo "Exit status: ${EXIT_STATUS}"
      exit ${EXIT_STATUS}

tasks:
  restart:
    action: "Fake container task"
    description: "Pretend to run a task inside a tooling container"
    steps:
      - ./bin/deployer bash -lc "echo 'Pretending to run a task'"
